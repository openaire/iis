<workflow-app xmlns="uri:oozie:workflow:0.4" name="primary_main">

    <parameters>
        <property>
            <name>remove_sideproducts</name>
            <value>false</value>
            <description>flag indicating inference side products will be erased</description>
        </property>
        <property>
            <name>match_content_with_metadata</name>
            <value>true</value>
            <description>flag indicating contents should be filtered and their identifiers should be deduplicated against metadata entries retrieved from InformationSpace.
                This way only contents having metadata representation will be processed.
                To be disabled when processing new contents which metadata is not available in infospace or when original identifiers should be preserved (contents will not be filtered as well).
            </description>
        </property>
        <!-- processing modes -->
        <property>
            <name>active_referenceextraction_project</name>
            <value>false</value>
            <description>flag indicating project reference extraction should be enabled</description>
        </property>
        <property>
            <name>active_referenceextraction_dataset</name>
            <value>false</value>
            <description>flag indicating dataset reference extraction should be enabled</description>
        </property>
        <property>
            <!-- currently disabled by default -->
            <name>active_referenceextraction_researchinitiative</name>
            <value>false</value>
            <description>flag indicating researchinitiative reference extraction should be enabled</description>
        </property>
        <property>
            <!-- currently disabled by default -->
            <name>active_referenceextraction_community</name>
            <value>false</value>
            <description>flag indicating community reference extraction should be enabled</description>
        </property>
        <property>
            <!-- currently disabled by default -->
            <name>active_referenceextraction_pdb</name>
            <value>false</value>
            <description>flag indicating protein databank reference extraction should be enabled</description>
        </property>
        <property>
            <!-- currently disabled by default -->
            <name>active_referenceextraction_software_url</name>
            <value>false</value>
            <description>flag indicating software url reference extraction should be enabled</description>
        </property>
        <property>
            <name>active_referenceextraction_covid19</name>
            <value>false</value>
            <description>flag indicating covid19 reference extraction should be enabled</description>
        </property>
        <property>
            <name>active_referenceextraction_eoscservice</name>
            <value>false</value>
            <description>flag indicating EOSC service reference extraction should be enabled</description>
        </property>
        <property>
            <name>active_documentsclassification</name>
            <value>false</value>
            <description>flag indicating documents classification should be enabled</description>
        </property>
        <property>
            <name>active_documentssimilarity</name>
            <value>false</value>
            <description>flag indicating documents similarity should be enabled</description>
        </property>
        <property>
            <name>active_citationmatching</name>
            <value>false</value>
            <description>flag indicating citation matching should be enabled</description>
        </property>
        <property>
            <name>active_document_affiliation</name>
            <value>true</value>
            <description>flag indicating affiliation matching should be enabled</description>
        </property>
        <property>
            <name>active_referenceextraction_patent</name>
            <value>false</value>
            <description>flag indicating if patent reference extraction should be enabled</description>
        </property>
        <!-- import concepts related -->
        <property>
            <name>import_islookup_service_location</name>
            <value>$UNDEFINED$</value>
            <description>IS Lookup service location</description>
        </property>
        <property>
            <name>import_context_service_location</name>
            <value>$UNDEFINED$</value>
            <description>RESTful context service location</description>
        </property>
        <property>
            <name>import_project_concepts_context_ids_csv</name>
            <value>fet-fp7,fet-h2020</value>
            <description>comma separated list of concepts context identifiers to be picked by ISLookup</description>
        </property>
        <!-- import metadata related -->
        <property>
            <name>import_infospace_graph_location</name>
            <description>local InformationSpace graph location</description>
        </property>
        <property>
            <name>import_infospace_eligible_service_collectedfrom_datasourceid</name>
            <description>data source identifier eligible services can be collected from</description>
        </property>
        <!-- aggregation subsystem based import content related -->
        <property>
            <name>import_content_pdfaggregation_table_name</name>
            <value>$UNDEFINED$</value>
            <description>Hive table name which is a part of the PDF aggregation subsystem, 
            defined in 'dbname.tablename' format to indicate both database and table.
            This property value dictates the underlying importer module to be used: when set to $UNDEFINED$ value the old
            ObjectStore based importer is activated otherwise PDF aggregation subsystem based importer is used.</description>
        </property>
        <property>
            <name>import_content_pdfaggregation_hive_metastore_uris</name>
            <value>$UNDEFINED$</value>
            <description>URIs pointing to the hive metastore utilized by the PDF aggregation subsystem</description>
        </property>
        <!-- objectstore based import content related -->
        <property>
            <name>import_content_object_store_location</name>
            <value>$UNDEFINED$</value>
            <description>object store service location required for content retrieval</description>
        </property>
        <property>
            <name>import_content_objectstores_csv</name>
            <value>$UNDEFINED$</value>
            <description>CSV list of object stores identifiers to be processed</description>
        </property>
        <!-- S3 related -->
        <property>
            <name>import_content_objectstore_s3_keystore_location</name>
            <value>$UNDEFINED$</value>
            <description>keystore holding credentials giving read access to S3 bucket with contents</description>
        </property>
        <property>
            <name>import_content_objectstore_s3_endpoint</name>
            <value>$UNDEFINED$</value>
            <description>S3 service providing contents endpoint</description>
        </property>
        <!--  -->
        <property>
            <name>import_content_mimetypes_pdf</name>
            <value>pdf,application/pdf</value>
            <description>pdf mime types</description>
        </property>
        <property>
            <name>import_content_mimetypes_html</name>
            <value>text/html</value>
            <description>html mime types</description>
        </property>
        <property>
            <name>import_content_mimetypes_xml_pmc</name>
            <value>xml,application/xml</value>
            <description>xml pmc types</description>
        </property>
        <property>
            <name>import_content_mimetypes_wos</name>
            <value>file::WoS</value>
            <description>WoS types</description>
        </property>
        <property>
            <name>import_patent_tsv</name>
            <description>input TSV file location with patents basic metadata</description>
        </property>
        <!-- import timeouts related -->
        <property>
            <name>import_resultset_client_read_timeout</name>
            <value>60000</value>
            <description>resultset client read timeout (expressed in milliseconds)</description>
        </property>
        <property>
            <name>import_resultset_client_connection_timeout</name>
            <value>60000</value>
            <description>resultset client connection timeout (expressed in milliseconds)</description>
        </property>
        <property>
            <name>import_content_connection_timeout</name>
            <value>60000</value>
            <description>import content connection timeout (expressed in milliseconds)</description>
        </property>
        <property>
            <name>import_content_read_timeout</name>
            <value>60000</value>
            <description>import content read timeout (expressed in milliseconds)</description>
        </property>
        <property>
            <name>text_xml_max_file_size_mb</name>
            <value>2</value>
            <description>maximum allowed xml or text file size in Megabytes</description>
        </property>
        <property>
            <name>ingest_pmc_cache_location</name>
            <description>PMC ingestion HDFS cache location</description>
        </property>
        <!-- metadata extraction related -->
        <property>
            <name>metadataextraction_excluded_checksums</name>
            <value>$UNDEFINED$</value>
            <description>list of content checksums excluded from metadataextraction processing</description>
        </property>
        <property>
            <name>pdf_max_file_size_mb</name>
            <value>100</value>
            <description>maximum allowed pdf file size in Megabytes</description>
        </property>
        <property>
            <name>metadataextraction_cache_location</name>
            <description>metadata extraction HDFS cache location</description>
        </property>
        <property>
            <name>software_webcrawl_cache_location</name>
            <description>software reference extraction HDFS cache location</description>
        </property>
        <property>
            <name>patent_cache_location</name>
            <description>patent HDFS cache location</description>
        </property>
        <!-- project reference extraction related -->
        <property>
            <name>referenceextraction_project_fundingclass_blacklist_regex</name>
            <value>a^</value>
            <description>regexp matching funding class, describes projects which
                should be ignored by reference extraction algorithm.
                Set to 'a^' by default to guarantee nothing will be matched.
            </description>
        </property>
        <!-- citation matching related -->
        <property>
            <name>citationmatchingFuzzyNumberOfPartitions</name>
            <description>number of partitions used for rdds with citations and documents read from input files</description>
        </property>
        <property>
            <name>citationmatchingFuzzyCacheLocation</name>
            <description>fuzzy citation matching HDFS cache location</description>
        </property>
        <!-- action set id properties -->
        <property>
            <name>export_action_set_id_document_similarities_standard</name>
            <value>$UNDEFINED$</value>
            <description>document_similarities_standard action-set identifier of exported data</description>
        </property>
        <property>
            <name>export_action_set_id_matched_doc_organizations</name>
            <value>$UNDEFINED$</value>
            <description>affiliation matching outcome action-set identifier</description>
        </property>
        <property>
            <name>export_action_set_id_document_classes</name>
            <value>$UNDEFINED$</value>
            <description>document_classes action-set identifier of exported data</description>
        </property>
        <property>
            <name>export_action_set_id_document_referencedProjects</name>
            <value>$UNDEFINED$</value>
            <description>document_referencedProjects action-set identifier of exported data</description>
        </property>
        <property>
            <name>export_action_set_id_document_referencedDatasets</name>
            <value>$UNDEFINED$</value>
            <description>document_referencedDatasets action-set identifier of exported data</description>
        </property>
        <property>
            <name>export_action_set_id_document_referencedDocuments</name>
            <value>$UNDEFINED$</value>
            <description>document_referencedDocuments action-set identifier of exported data</description>
        </property>
        <property>
            <name>export_action_set_id_document_eoscServices</name>
            <value>$UNDEFINED$</value>
            <description>document_eoscServices action-set identifier of exported data</description>
        </property>
        <property>
            <name>export_action_set_id_document_research_initiative</name>
            <value>$UNDEFINED$</value>
            <description>document research initiative action-set identifier of exported data</description>
        </property>
        <property>
            <name>export_action_set_id_document_community</name>
            <value>$UNDEFINED$</value>
            <description>document community action-set identifier of exported data</description>
        </property>
        <property>
            <name>export_action_set_id_document_pdb</name>
            <value>$UNDEFINED$</value>
            <description>document to protein databank action-set identifier of exported data</description>
        </property>
        <property>
            <name>export_action_set_id_document_covid19</name>
            <value>$UNDEFINED$</value>
            <description>document to covid19 action-set identifier of exported data</description>
        </property>
        <property>
            <name>export_action_set_id_document_software_url</name>
            <value>$UNDEFINED$</value>
            <description>document to software url action-set identifier of exported data</description>
        </property>
        <!-- -->
        <property>
            <name>export_action_set_id_entity_software</name>
            <value>$UNDEFINED$</value>
            <description>action-set identifier of exported data containing software entities</description>
        </property>
        <property>
            <name>export_action_set_id_document_patent</name>
            <value>$UNDEFINED$</value>
            <description>document to patent action-set identifier of exported data</description>
        </property>
        <property>
            <name>export_action_set_id_entity_patent</name>
            <value>$UNDEFINED$</value>
            <description>action-set identifier of exported data containing patent entities</description>
        </property>
        <property>
            <name>export_action_set_id_citation_relations</name>
            <value>$UNDEFINED$</value>
            <description>action-set identifier of exported data containing citation relations</description>
        </property>
        <!-- trust level threshold section -->
        <property>
            <name>export_trust_level_threshold</name>
            <value>$UNDEFINED$</value>
            <description>default trust level threshold of exported data</description>
        </property>
        <property>
            <name>export_trust_level_threshold_document_classes</name>
            <value>$UNDEFINED$</value>
            <description>document_classes trust level threshold</description>
        </property>
        <property>
            <name>export_trust_level_threshold_document_referencedProjects</name>
            <value>$UNDEFINED$</value>
            <description>document_referencedProjects trust level threshold</description>
        </property>
        <property>
            <name>export_trust_level_threshold_document_referencedDatasets</name>
            <value>$UNDEFINED$</value>
            <description>document_referencedDatasets trust level threshold</description>
        </property>
        <property>
            <name>export_trust_level_threshold_document_pdb</name>
            <value>$UNDEFINED$</value>
            <description>document to protein databank trust level threshold</description>
        </property>
        <property>
            <name>export_trust_level_threshold_document_software_url</name>
            <value>$UNDEFINED$</value>
            <description>document to software url trust level threshold</description>
        </property>
        <property>
            <name>export_trust_level_threshold_matched_doc_organizations</name>
            <value>$UNDEFINED$</value>
            <description>document to organization trust level threshold</description>
        </property>
        <property>
            <name>export_trust_level_threshold_document_referencedDocuments</name>
            <value>$UNDEFINED$</value>
            <description>document_referencedDocuments trust level threshold</description>
        </property>
        <property>
            <name>export_trust_level_threshold_document_eoscServices</name>
            <value>$UNDEFINED$</value>
            <description>document_eoscServices trust level threshold</description>
        </property>
        <!-- -->
        <property>
            <name>export_documentssimilarity_threshold</name>
            <value>$UNDEFINED$</value>
            <description>documents similarity threshold value below which similarity export is omitted</description>
        </property>
        <property>
            <name>export_trust_level_threshold_document_patent</name>
            <value>$UNDEFINED$</value>
            <description>document to patent trust level threshold</description>
        </property>
        <property>
            <name>export_relation_collectedfrom_key</name>
            <description>datasource identifier to be stored in Relation#collectedfrom[].key</description>
        </property>
        <property>
            <name>export_referenceextraction_pdb_url_root</name>
            <value>http://www.rcsb.org/pdb/explore/explore.do?structureId=</value>
            <description>protein databank URL root part to be concatenated with pdb identifier when forming final URL</description>
        </property>
        <property>
            <name>export_patent_date_of_collection</name>
            <description>date of collection of patent file formatted as yyyy-MM-dd'T'HH:mm</description>
        </property>
        <property>
            <name>export_patent_epo_url_root</name>
            <value>https://register.epo.org/application?number=</value>
            <description>EPO patent web archive URL root part to be concatenated with patent auth and nr when forming final URL</description>
        </property>
        <property>
            <name>output_remote_location</name>
            <description>optional remote cluster output location where inference output dump should be distcped as sequence files. When not specified results will be exported straight to the ActionManager.</description>
        </property>
        <!-- working directory related -->
        <property>
            <name>execution_environment</name>
            <value>primary</value>
            <description>execution environment used for workingDir creation</description>
        </property>
        <property>
            <name>workingDir</name>
            <value>/user/${user.name}/iis/working_dirs/${execution_environment}</value>
            <description>working directory</description>
        </property>
        <property>
            <name>reports_external_path</name>
            <value>$UNDEFINED$</value>
            <description>directory for storing reports from different executions of the workflow</description>
        </property>
        <!-- generic spark configuration -->
        <!-- sparkDriverMemory, sparkExecutorMemory, sparkExecutorCores values should be provided by environment (since git#889) -->
        <property>
            <name>sparkDriverMemory</name>
            <description>memory for driver process</description>
        </property>
        <property>
            <name>sparkExecutorMemory</name>
            <description>memory for individual executor</description>
        </property>
        <property>
            <name>sparkExecutorCores</name>
            <description>number of cores used by single executor</description>
        </property>
        <!-- specific spark configuration -->
        <property>
            <name>entityExportSparkDriverMemory</name>
            <value>${sparkDriverMemory}</value>
            <description>memory for driver process</description>
        </property>
        <property>
            <name>entityExportSparkExecutorMemory</name>
            <value>${sparkExecutorMemory}</value>
            <description>memory for individual executor</description>
        </property>
        <property>
            <name>entityExportSparkExecutorCores</name>
            <value>${sparkExecutorCores}</value>
            <description>number of cores used by single executor</description>
        </property>
        <property>
            <name>metric_pusher_address</name>
            <description>pushgateway service location</description>
        </property>
    </parameters>

    <global>
        <job-tracker>${jobTracker}</job-tracker>
        <name-node>${nameNode}</name-node>
        <configuration>
            <property>
                <name>mapreduce.job.queuename</name>
                <value>${queueName}</value>
            </property>
            <property>
                <name>oozie.launcher.mapred.job.queue.name</name>
                <value>${oozieLauncherQueueName}</value>
            </property>
        </configuration>
    </global>

    <start to="init-workingDir" />

    <action name="init-workingDir">
        <fs>
            <delete path="${nameNode}${workingDir}" />
            <mkdir path="${nameNode}${workingDir}" />
        </fs>
        <ok to="validate-output" />
        <error to="fail" />
    </action>

    <action name="validate-output">
        <sub-workflow>
            <app-path>${wf:appPath()}/primary_validate_output</app-path>
            <propagate-configuration />
        </sub-workflow>
        <ok to="copy-version" />
        <error to="fail" />
    </action>

    <action name="copy-version">
        <distcp xmlns="uri:oozie:distcp-action:0.2">
            <arg>${wf:appPath()}/version.properties</arg>
            <arg>${nameNode}${workingDir}</arg>
        </distcp>
        <ok to="import" />
        <error to="fail" />
    </action>

    <action name="import">
        <sub-workflow>
            <app-path>${wf:appPath()}/primary_import</app-path>
            <propagate-configuration />
            <configuration>
                <property>
                    <name>workingDir</name>
                    <value>${workingDir}/primary_import/working_dir
                    </value>
                </property>
                <!-- importing modes -->
                <property>
                    <name>match_content_with_metadata</name>
                    <value>${match_content_with_metadata}</value>
                </property>
                <property>
                    <name>active_import_patent</name>
                    <value>${active_referenceextraction_patent}</value>
                </property>
                <!-- import metadata related -->
                <property>
                    <name>infospace_graph_location</name>
                    <value>${import_infospace_graph_location}</value>
                </property>
                <property>
                    <name>infospace_eligible_service_collectedfrom_datasourceid</name>
                    <value>${import_infospace_eligible_service_collectedfrom_datasourceid}</value>
                </property>
                <!-- project concept related -->
                <property>
                    <name>islookup_service_location</name>
                    <value>${import_islookup_service_location}</value>
                </property>
                <property>
                    <name>context_service_location</name>
                    <value>${import_context_service_location}</value>
                </property>
                <property>
                    <name>project_concepts_context_ids_csv</name>
                    <value>${import_project_concepts_context_ids_csv}</value>
                </property>
                <!-- new aggregation subsystem based import content related -->
                <property>
                    <name>input_table_name</name>
                    <value>${import_content_pdfaggregation_table_name}</value>
                </property>
                <property>
                    <name>hive_metastore_uris</name>
                    <value>${import_content_pdfaggregation_hive_metastore_uris}</value>
                </property>
                <!-- old objectstore based import content related -->
                <property>
                    <name>objectstore_service_location</name>
                    <value>${import_content_object_store_location}</value>
                </property>
                <property>
                    <name>objectstore_s3_keystore_location</name>
                    <value>${import_content_objectstore_s3_keystore_location}</value>
                </property>
                
                <property>
                    <name>objectstore_s3_endpoint</name>
                    <value>${import_content_objectstore_s3_endpoint}</value>
                </property>
                <property>
                    <name>approved_objectstores_csv</name>
                    <value>${import_content_objectstores_csv}</value>
                </property>
                <property>
                    <name>mimetypes_pdf</name>
                    <value>${import_content_mimetypes_pdf}</value>
                </property>
                <property>
                    <name>mimetypes_html</name>
                    <value>${import_content_mimetypes_html}</value>
                </property>
                <property>
                    <name>mimetypes_xml_pmc</name>
                    <value>${import_content_mimetypes_xml_pmc}</value>
                </property>
                <property>
                    <name>mimetypes_wos</name>
                    <value>${import_content_mimetypes_wos}</value>
                </property>
                <!-- import patent related -->
                <property>
                    <name>input_patent_tsv</name>
                    <value>${import_patent_tsv}</value>
                </property>
                <!-- import timeouts related -->
                <property>
                    <name>resultset_client_read_timeout</name>
                    <value>${import_resultset_client_read_timeout}</value>
                </property>
                <property>
                    <name>resultset_client_connection_timeout</name>
                    <value>${import_resultset_client_connection_timeout}</value>
                </property>
                <property>
                    <name>content_connection_timeout</name>
                    <value>${import_content_connection_timeout}</value>
                </property>
                <property>
                    <name>content_read_timeout</name>
                    <value>${import_content_read_timeout}</value>
                </property>
                <!-- metadata extraction related are autmatically propagated -->
                <!-- metadatainput and metadataextraction output subdirectory names -->
                <property>
                    <name>metadataimport_output_name_document_meta</name>
                    <value>docmeta</value>
                </property>
                <property>
                    <name>metadataimport_output_name_dataset_meta</name>
                    <value>dataset</value>
                </property>
                <property>
                    <name>metadataimport_output_name_document_project</name>
                    <value>docproject</value>
                </property>
                <property>
                    <name>metadataimport_output_name_project</name>
                    <value>project</value>
                </property>
                <property>
                    <name>metadataimport_output_name_identifier_mapping</name>
                    <value>identifiermapping</value>
                </property>
                <property>
                    <name>metadataimport_output_name_organization</name>
                    <value>organization</value>
                </property>
                <property>
                    <name>metadataimport_output_name_project_organization</name>
                    <value>projectorg</value>
                </property>
                <property>
                    <name>metadataimport_output_name_service</name>
                    <value>service</value>
                </property>
                <!-- output parameters -->
                <property>
                    <name>output_extracted_document_metadata</name>
                    <value>${workingDir}/primary_import/extracted_document_metadata</value>
                </property>
                <property>
                    <name>output_metadataimport_root</name>
                    <value>${workingDir}/primary_import/metadataimport</value>
                </property>
                <property>
                    <name>output_document_text</name>
                    <value>${workingDir}/primary_import/document-text</value>
                </property>
                <property>
                    <name>output_concept</name>
                    <value>${workingDir}/primary_import/concept</value>
                </property>
                <property>
                    <name>output_wos</name>
                    <value>${workingDir}/primary_import/wos</value>
                </property>
                <property>
                    <name>output_patent</name>
                    <value>${workingDir}/primary_import/patent</value>
                </property>
                <property>
                    <name>output_faults</name>
                    <value>${workingDir}/primary_import/faults</value>
                </property>
                <property>
                    <name>output_report_root_path</name>
                    <value>${workingDir}/report</value>
                </property>
            </configuration>
        </sub-workflow>
        <ok to="primary-processing" />
        <error to="fail" />
    </action>

    <action name="primary-processing">
        <sub-workflow>
            <app-path>${wf:appPath()}/primary_processing</app-path>
            <propagate-configuration />
            <configuration>
                <property>
                    <name>input_document_metadata</name>
                    <value>${workingDir}/primary_import/metadataimport/docmeta
                    </value>
                </property>
                <property>
                    <name>input_document_to_project</name>
                    <value>${workingDir}/primary_import/metadataimport/docproject
                    </value>
                </property>
                <property>
                    <name>input_project_to_organization</name>
                    <value>${workingDir}/primary_import/metadataimport/projectorg</value>
                </property>
                <property>
                    <name>input_document_text</name>
                    <value>${workingDir}/primary_import/document-text
                    </value>
                </property>
                <property>
                    <name>input_document_text_wos</name>
                    <value>${workingDir}/primary_import/wos</value>
                </property>
                <property>
                    <name>input_project</name>
                    <value>${workingDir}/primary_import/metadataimport/project
                    </value>
                </property>
                <property>
                    <name>input_organizations</name>
                    <value>${workingDir}/primary_import/metadataimport/organization</value>
                </property>
                <property>
                    <name>input_dataset</name>
                    <value>${workingDir}/primary_import/metadataimport/dataset</value>
                </property>
                <property>
                    <name>input_service</name>
                    <value>${workingDir}/primary_import/metadataimport/service</value>
                </property>
                <property>
                    <name>input_extracted_document_metadata</name>
                    <value>${workingDir}/primary_import/extracted_document_metadata</value>
                </property>
                <property>
                    <name>input_concept</name>
                    <value>${workingDir}/primary_import/concept</value>
                </property>
                <property>
                    <name>input_patent</name>
                    <value>${workingDir}/primary_import/patent</value>
                </property>
                <property>
                    <name>output_merged_metadata</name>
                    <value>${workingDir}/transformers_metadatamerger/output_merged_metadata</value>
                </property>
                <property>
                    <name>output_document_to_project</name>
                    <value>${workingDir}/exported/document_to_project</value>
                </property>
                <property>
                    <name>output_document_to_dataset</name>
                    <value>${workingDir}/exported/document_to_dataset</value>
                </property>
                <property>
                    <name>output_document_to_research_initiatives</name>
                    <value>${workingDir}/exported/document_to_research_initiatives
                    </value>
                </property>
                <property>
                    <name>output_document_to_community</name>
                    <value>${workingDir}/exported/document_to_community</value>
                </property>
                <property>
                    <name>output_document_to_pdb</name>
                    <value>${workingDir}/exported/document_to_pdb</value>
                </property>
                <property>
                    <name>output_document_to_covid19</name>
                    <value>${workingDir}/exported/document_to_covid19</value>
                </property>
                <property>
                    <name>output_document_to_service</name>
                    <value>${workingDir}/exported/document_to_service</value>
                </property>
                <property>
                    <name>output_document_to_software_url</name>
                    <value>${workingDir}/exported/document_to_software_url</value>
                </property>
                <property>
                    <name>output_document_to_document_classes</name>
                    <value>${workingDir}/exported/document_to_document_classes</value>
                </property>
                <property>
                    <name>output_citation</name>
                    <value>${workingDir}/exported/citation</value>
                </property>
                <property>
                    <name>output_document_similarity</name>
                    <value>${workingDir}/exported/document_similarity</value>
                </property>
                <property>
                    <name>output_matched_doc_organizations</name>
                    <value>${workingDir}/exported/matched_affiliation</value>
                </property>
                <property>
                    <name>output_document_to_patent</name>
                    <value>${workingDir}/exported/document_to_patent</value>
                </property>
                <property>
                    <name>output_patent_metadata</name>
                    <value>${workingDir}/exported/patent_metadata</value>
                </property>
                <property>
                    <name>output_report_root_path</name>
                    <value>${workingDir}/report</value>
                </property>
            </configuration>
        </sub-workflow>
        <ok to="export-to-actionmanager" />
        <error to="fail" />
    </action>

    <action name="export-to-actionmanager">
        <sub-workflow>
            <app-path>${wf:appPath()}/primary_export</app-path>
            <propagate-configuration />
            <configuration>
                <property>
                    <name>workingDir</name>
                    <value>${workingDir}/primary_export/working_dir
                    </value>
                </property>
                <!-- input ports -->
                <property>
                    <name>input_document_metadata</name>
                    <value>${workingDir}/transformers_metadatamerger/output_merged_metadata</value>
                </property>
                <property>
                    <name>input_document_to_project</name>
                    <value>${workingDir}/exported/document_to_project</value>
                </property>
                <property>
                    <name>input_document_to_dataset</name>
                    <value>${workingDir}/exported/document_to_dataset</value>
                </property>
                <property>
                    <name>input_document_to_research_initiatives</name>
                    <value>${workingDir}/exported/document_to_research_initiatives</value>
                </property>
                <property>
                    <name>input_document_to_community</name>
                    <value>${workingDir}/exported/document_to_community</value>
                </property>
                <property>
                    <name>input_document_to_pdb</name>
                    <value>${workingDir}/exported/document_to_pdb</value>
                </property>
                <property>
                    <name>input_document_to_covid19</name>
                    <value>${workingDir}/exported/document_to_covid19</value>
                </property>
                <property>
                    <name>input_document_to_service</name>
                    <value>${workingDir}/exported/document_to_service</value>
                </property>
                <property>
                    <name>input_document_to_software_url</name>
                    <value>${workingDir}/exported/document_to_software_url</value>
                </property>
                <property>
                    <name>input_document_to_document_classes</name>
                    <value>${workingDir}/exported/document_to_document_classes</value>
                </property>
                <property>
                    <name>input_citations</name>
                    <value>${workingDir}/exported/citation</value>
                </property>
                <property>
                    <name>input_document_similarity</name>
                    <value>${workingDir}/exported/document_similarity</value>
                </property>
                <property>
                    <name>input_matched_doc_organizations</name>
                    <value>${workingDir}/exported/matched_affiliation</value>
                </property>
                <property>
                    <name>input_document_to_patent</name>
                    <value>${workingDir}/exported/document_to_patent</value>
                </property>
                <property>
                    <name>input_patent</name>
                    <value>${workingDir}/exported/patent_metadata</value>
                </property>
                <!-- entities exporting modes -->
                <property>
                    <name>active_export_software</name>
                    <value>${active_referenceextraction_software_url}</value>
                </property>
                <property>
                    <name>active_export_patent</name>
                    <value>${active_referenceextraction_patent}</value>
                </property>
                <!-- action set id properties -->
                <property>
                    <name>action_set_id_document_similarities_standard</name>
                    <value>${export_action_set_id_document_similarities_standard}</value>
                </property>
                <property>
                    <name>action_set_id_matched_doc_organizations</name>
                    <value>${export_action_set_id_matched_doc_organizations}</value>
                </property>
                <property>
                    <name>action_set_id_document_classes</name>
                    <value>${export_action_set_id_document_classes}</value>
                </property>
                <property>
                    <name>action_set_id_document_referencedProjects</name>
                    <value>${export_action_set_id_document_referencedProjects}</value>
                </property>
                <property>
                    <name>action_set_id_document_referencedDatasets</name>
                    <value>${export_action_set_id_document_referencedDatasets}</value>
                </property>
                <property>
                    <name>action_set_id_document_referencedDocuments</name>
                    <value>${export_action_set_id_document_referencedDocuments}</value>
                </property>
                <property>
                    <name>action_set_id_document_eoscServices</name>
                    <value>${export_action_set_id_document_eoscServices}</value>
                </property>
                <property>
                    <name>action_set_id_document_research_initiative</name>
                    <value>${export_action_set_id_document_research_initiative}</value>
                </property>
                <property>
                    <name>action_set_id_document_community</name>
                    <value>${export_action_set_id_document_community}</value>
                </property>
                <property>
                    <name>action_set_id_document_pdb</name>
                    <value>${export_action_set_id_document_pdb}</value>
                </property>
                <property>
                    <name>action_set_id_document_covid19</name>
                    <value>${export_action_set_id_document_covid19}</value>
                </property>
                <property>
                    <name>action_set_id_document_software_url</name>
                    <value>${export_action_set_id_document_software_url}</value>
                </property>
                <property>
                    <name>action_set_id_entity_software</name>
                    <value>${export_action_set_id_entity_software}</value>
                </property>
                <property>
                    <name>action_set_id_document_patent</name>
                    <value>${export_action_set_id_document_patent}</value>
                </property>
                <property>
                    <name>action_set_id_entity_patent</name>
                    <value>${export_action_set_id_entity_patent}</value>
                </property>
                <property>
                    <name>action_set_id_citation_relations</name>
                    <value>${export_action_set_id_citation_relations}</value>
                </property>

                <property>
                    <name>trust_level_threshold</name>
                    <value>${export_trust_level_threshold}</value>
                </property>
                <property>
                    <name>trust_level_threshold_document_referencedProjects</name>
                    <value>${export_trust_level_threshold_document_referencedProjects}</value>
                </property>
                <property>
                    <name>trust_level_threshold_document_referencedDatasets</name>
                    <value>${export_trust_level_threshold_document_referencedDatasets}</value>
                </property>
                <property>
                    <name>trust_level_threshold_document_classes</name>
                    <value>${export_trust_level_threshold_document_classes}</value>
                </property>
                <property>
                    <name>trust_level_threshold_document_pdb</name>
                    <value>${export_trust_level_threshold_document_pdb}</value>
                </property>
                <property>
                    <name>trust_level_threshold_document_software_url</name>
                    <value>${export_trust_level_threshold_document_software_url}</value>
                </property>
                <property>
                    <name>trust_level_threshold_matched_doc_organizations</name>
                    <value>${export_trust_level_threshold_matched_doc_organizations}</value>
                </property>
                <property>
                    <name>trust_level_threshold_document_patent</name>
                    <value>${export_trust_level_threshold_document_patent}</value>
                </property>
                <property>
                    <name>trust_level_threshold_document_referencedDocuments</name>
                    <value>${export_trust_level_threshold_document_referencedDocuments}</value>
                </property>
                <property>
                    <name>trust_level_threshold_document_eoscServices</name>
                    <value>${export_trust_level_threshold_document_eoscServices}</value>
                </property>
                <property>
                    <name>collectedfrom_key</name>
                    <value>${export_relation_collectedfrom_key}</value>
                </property>
                <property>
                    <name>documentssimilarity_threshold</name>
                    <value>${export_documentssimilarity_threshold}</value>
                </property>
                <property>
                    <name>referenceextraction_pdb_url_root</name>
                    <value>${export_referenceextraction_pdb_url_root}</value>
                </property>
                <property>
                    <name>patent_date_of_collection</name>
                    <value>${export_patent_date_of_collection}</value>
                </property>
                <property>
                    <name>patent_epo_url_root</name>
                    <value>${export_patent_epo_url_root}</value>
                </property>
                <property>
                    <name>output_report_root_path</name>
                    <value>${workingDir}/report</value>
                </property>
                <!-- spark configuration related -->
                <property>
                    <name>sparkDriverMemory</name>
                    <value>${entityExportSparkDriverMemory}</value>
                </property>
                <property>
                    <name>sparkExecutorMemory</name>
                    <value>${entityExportSparkExecutorMemory}</value>
                </property>
                <property>
                    <name>sparkExecutorCores</name>
                    <value>${entityExportSparkExecutorCores}</value>
                </property>
            </configuration>
        </sub-workflow>
        <ok to="report-execution-times" />
        <error to="fail" />
    </action>

    <action name="report-execution-times">
        <java>
            <main-class>eu.dnetlib.iis.common.java.ProcessWrapper</main-class>
            <arg>eu.dnetlib.iis.common.report.OozieTimeReportGenerator</arg>
            <arg>-PjobId=${wf:id()}</arg>
            <arg>-PoozieServiceLoc=${oozieServiceLoc}</arg>
            <arg>-Preport.import.duration=import</arg>
            <arg>-Preport.processing.duration=primary-processing</arg>
            <arg>-Preport.export.duration=export-to-actionmanager,export-to-json</arg>
            
            <arg>-Oreport=${workingDir}/report/primary-main-execution-times</arg>
        </java>
        <ok to="build-report" />
        <error to="fail" />
    </action>

    <action name="build-report">
        <sub-workflow>
            <app-path>${wf:appPath()}/primary_report</app-path>
            <propagate-configuration />
            <configuration>
                <property>
                    <name>working_dir</name>
                    <value>${workingDir}/report/working_dir</value>
                </property>
                <property>
                    <name>input_partial_reports</name>
                    <value>${workingDir}/report</value>
                </property>
            </configuration>
        </sub-workflow>
        <ok to="end" />
        <error to="fail" />
    </action>

    <kill name="fail">
        <message>Unfortunately, the process failed -- error message:
            [${wf:errorMessage(wf:lastErrorNode())}]
        </message>
    </kill>

    <end name="end" />
</workflow-app>
